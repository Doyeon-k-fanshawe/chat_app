// imports will always go at the top
import ChatMsg from './components/ChatMessage.js';

const socket = io();

//utility function for socekt
function setUserID({ sID }) {
  // debugger;

  // save our unique ID generated by Socket on the server side 
  // - this is how we track individual connections to the chat service
  vm.socketID = sID;
  vm.connectstatus = "Connected!"
}

function showNewMessage({ message }) {
  vm.messages.push(message);
}

function handleUserTyping(user) {
  console.log('Somebody is typing something');
  vm.typing = "Somebody is typing something now"
  vm.status = "online";
}

const { createApp } = Vue

  const vm = createApp({
    data() {
      return {
        socketID: '',
        message: '',
        messages: [],
        nickname: '',
        activePic: '/images/fox.png',
        pictures: [
          '/images/fox.png',
          '/images/rac.png',
          '/images/owl.png',
          '/images/hed.png',
        ],
        indexOfActive: 0,
        status: '',
        typing: '',
        connectstatus: ''
      }
    },

    methods: {
      dispatchMessage() {
        // debugger;
        socket.emit('chat_message', {
          content: this.message,
          name: this.nickname || 'anonymous',
          id: this.socketID,
        })

        this.message = "";
      },

      catchTextFocus() {
        // emit a custome typing event and broadcast it to the server
        socket.emit('user_typing', {
          name: this.nickname || 'anonymous'
        })
      },

      changeActivePic(index) {
        this.activePic = this.pictures[index];
        this.indexOfActive = index;
      }

    },

    components: {
      newmsg: ChatMsg
    }
  }).mount('#app')

  socket.addEventListener('connected', setUserID);
  socket.addEventListener('new_message', showNewMessage);
  socket.addEventListener('typing', handleUserTyping);